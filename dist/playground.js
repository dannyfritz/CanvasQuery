(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.playground = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
function playground(t){return new Playground(t)}function Playground(t){function e(){requestAnimationFrame(e);var t=Date.now()-n;if(n=Date.now(),!(t>1e3)){var s=t/1e3;i.lifetime+=s,i.elapsed=s,i.delta=s,i.tweens.step(s),i.loader.count<=0?(i.eventsHandler("step",s),i.eventsHandler("render",s),i.eventsHandler("postrender",s),i.loaderTookScreenshot=!1):i.renderLoader(s),i.scaleToFit&&(i.screen.save(),i.screen.translate(i.offsetX,i.offsetY),i.screen.scale(i.scale,i.scale),i.screen.drawImage(i.layer.canvas,0,0),i.screen.restore()),i.gamepads.step(s),i.sound.step(s),i.music.step(s),i.videoRecorder.step(s)}}playground.extend(this,{smoothing:1,scale:1,preventKeyboardDefault:!0,preventContextMenu:!0,paths:{images:"images/"}},t),this.width&&this.height||(this.fitToContainer=!0),this.container||(this.container=document.body),this.container!==document.body&&(this.customContainer=!0),"string"==typeof this.container&&(this.container=document.querySelector(this.container)),this.state={},t.layer||(cq.smoothing=this.smoothing,navigator.isCocoonJS?(this.layer=cq.cocoon(1,1),this.layer.appendTo(this.container),this.screen=this.layer):(this.layer=cq(1,1),this.scaleToFit?(this.screen=cq(1,1),this.screen.appendTo(this.container)):(this.layer.appendTo(this.container),this.screen=this.layer)));this.screen.canvas;this.eventsHandler=this.eventsHandler.bind(this),this.mouse=new playground.Mouse(this,this.container),this.mouse.on("event",this.eventsHandler),this.mouse.preventContextMenu=this.preventContextMenu,this.touch=new playground.Touch(this,this.container),this.touch.on("event",this.eventsHandler),this.keyboard=new playground.Keyboard,this.keyboard.preventDefault=this.preventKeyboardDefault,this.keyboard.on("event",this.eventsHandler),this.gamepads=new playground.Gamepads,this.gamepads.on("event",this.eventsHandler),this.tweens=new playground.TweenManager(this),this.ease=playground.ease,window.addEventListener("resize",this.resizeHandler.bind(this)),setTimeout(this.resizeHandler.bind(this),1),this.videoRecorder=new playground.VideoRecorder(this),this.lifetime=0,this.elapsed=0,this.delta=0;var i=this,n=Date.now();requestAnimationFrame(e);{var s=(new Audio).canPlayType("audio/mp3");(new Audio).canPlayType('audio/ogg; codecs="vorbis"')}this.audioFormat=s?"mp3":"ogg",this.loader=new playground.Loader,this.images={},this.atlases={},this.data={};var o=window.AudioContext||window.webkitAudioContext||window.mozAudioContext;o?(this.audioContext=new o,this.sound=new Playground.Sound(this,this.audioContext),this.music=new Playground.Sound(this,this.audioContext)):(this.sound=new Playground.SoundFallback(this),this.music=new Playground.SoundFallback(this)),this.loadFoo(.5),this.create&&setTimeout(this.create.bind(this)),this.loader.on("ready",function(){i.foofooLoader=0}),this.loader.once("ready",function(){i.ready&&i.ready(),i.ready=function(){}})}var cq=require("canvasquery");playground.extend=function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[0][e]=arguments[t][e];return arguments[0]},playground.throttle=function(t,e){e||(e=250);var i,n;return function(){var s=this,o=+new Date,r=arguments;i&&i+e>o?(clearTimeout(n),n=setTimeout(function(){i=o,t.apply(s,r)},e)):(i=o,t.apply(s,r))}},Playground.prototype={setState:function(t){t.app=this,this.state&&(this.screenshot=this.layer.cache()),this.state&&this.state.leave&&this.state.leave(),this.state=t,this.state&&this.state.enter&&this.state.enter()},eventsHandler:function(t,e){this[t]&&this[t](e),this.state[t]&&this.state[t](e),this.state.proxy&&this.state.proxy(t,e)},resizeHandler:function(){if(this.customContainer)var t=this.container.offsetWidth,e=this.container.offsetHeight;else var t=window.innerWidth,e=window.innerHeight;this.fitToContainer&&(this.width=this.containerWidth,this.height=this.containerHeight),this.scaleToFit?(this.screen.width=t,this.screen.height=e,this.scale=Math.min(t/this.width,e/this.height),this.roundScale&&(this.scale=Math.max(1,Math.floor(this.scale))),this.offsetX=t/2-this.scale*(this.width/2)|0,this.offsetY=e/2-this.scale*(this.height/2)|0,this.mouse.scale=this.scale,this.mouse.offsetX=this.offsetX,this.mouse.offsetY=this.offsetY,this.touch.scale=this.scale,this.touch.offsetX=this.offsetX,this.touch.offsetY=this.offsetY):(this.fitToContainer&&(this.width=t,this.height=e),this.offsetX=0,this.offsetY=0),this.layer.width=this.width,this.layer.height=this.height,this.center={x:this.width/2|0,y:this.height/2|0},this.screen.clear("#000"),this.eventsHandler("resize"),this.mouse.update(),this.touch.update()},renderLoader:function(){var t=this.height/10|0,e=32,i=this.width-2*e,n=this.height/2-t/2|0;this.loaderTookScreenshot||(this.loaderTookScreenshot=!0,this.screenshot=this.layer.cache()),this.layer.clear("#000"),this.screenshot&&(this.layer.drawImage(this.screenshot,0,0),this.layer.clear("rgba(0,0,0,0.4)")),this.layer.strokeStyle("#fff").lineWidth(2).strokeRect(e,n,i,t),this.layer.fillStyle("#fff").fillRect(e,n,i*this.loader.progress|0,t)},record:function(t){this.videoRecorder.toggle(t)},loadFoo:function(t){this.foofooLoader||(this.foofooLoader=0);var e=this.loader;this.loader.add("foo "+t),setTimeout(function(){e.ready("foo "+t)},this.foofooLoader+=1e3*t)},loadAtlases:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];if("object"==typeof e)for(var i in e)this.loadAtlases(e[i]);else this._loadAtlas(e)}},loadAtlas:function(){return this.loadAtlases.apply(this,arguments)},_loadAtlas:function(t){var e=t.match(/(.*)\..*/),i=e?e[1]:t,n=this.loader;e||(t+=".png");var s="atlases/"+t;this.loader.add(s);var o=this.atlases[i]={},r=o.image=new Image;r.addEventListener("load",function(){n.ready(s)}),r.addEventListener("error",function(){n.error(s)}),r.src=s;var a="atlases/"+i+".json",h=new XMLHttpRequest;h.open("GET",a,!0),this.loader.add(a),h.onload=function(){var t=JSON.parse(this.response);o.frames=[],console.log(t.frames,o,i,a);for(var e=0;e<t.frames.length;e++){var s=t.frames[e];o.frames.push({region:[s.frame.x,s.frame.y,s.frame.w,s.frame.h],offset:[s.spriteSourceSize.x||0,s.spriteSourceSize.y||0],width:s.sourceSize.w,height:s.sourceSize.h})}n.ready(a)},h.send()},loadData:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];if("object"==typeof e)for(var i in e)this.loadData(e[i]);else{var n=e,s=n.match(/(.*)\..*/),i=s?s[1]:n;s||(n+=".json");var o=n.split(".").pop(),r="data/"+n,a=new XMLHttpRequest,h=this;a.open("GET",r,!0),this.loader.add(r),a.onload=function(){h.data[i]="json"===o?JSON.parse(this.responseText):this.responseText,h.loader.ready(r)},a.send()}}},loadImage:function(){return this.loadImages.apply(this,arguments)},loadImages:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];if("object"==typeof e)for(var i in e)this.loadImages(e[i]);else{var n=e,s=this.loader,o=n.match(/(.*)\..*/),i=o?o[1]:n;o||(n+=".png");var r=this.paths.images+n;this.loader.add(r);var a=this.images[i]=new Image;a.addEventListener("load",function(){s.ready(r)}),a.addEventListener("error",function(){s.error(r)}),a.src=r}}},loadSound:function(){return this.loadSounds.apply(this,arguments)},loadSounds:function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];if("object"==typeof e)for(var i in e)this.loadSounds(e[i]);else this.sound.load(e)}},loadFont:function(t){function e(){var i=cq(32,32);i.font("10px "+t).fillText(16,16,16),i.trim(),i.width!==h||i.height!==u?d.loader.ready("font "+t):setTimeout(e,250)}var i=document.createElement("style");i.type="text/css";var n={woff:"woff",ttf:"truetype"},s="";for(var o in n){var r=n[o];s+=' url("fonts/'+t+"."+o+"\") format('"+r+"');"}i.textContent="@font-face { font-family: '"+t+"'; src: "+s+" }",document.head.appendChild(i);var a=cq(32,32);a.font("10px huj"),a.fillText(16,16,16).trim();var h=a.width,u=a.height;this.loader.add("font "+t);var d=this;e()},playSound:function(t,e){if(!this.audioChannels){this.audioChannels=[];for(var i=0;16>i;i++)this.audioChannels.push(new Audio);this.audioChannelIndex=0}return this.sound.play(t,e)},stopSound:function(t){this.sound.stop(t)}},playground.Events=function(){this.listeners={}},playground.Events.prototype={on:function(t,e){return this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e),e},once:function(t,e){return e.once=!0,this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e),e},off:function(t,e){for(var i=0,n=this.listeners[t].length;n>i;i++)this.listeners[t][i]._remove&&(this.listeners[t].splice(i--,1),n--)},trigger:function(t,e){if(this.listeners.event)for(var i=0,n=this.listeners.event.length;n>i;i++)this.listeners.event[i](t,e);if(this.listeners[t])for(var i=0,n=this.listeners[t].length;n>i;i++){var s=this.listeners[t][i];s(e),s.once&&(this.listeners[t].splice(i--,1),n--)}}},playground.Mouse=function(t,e){var i=this;this.parent=t,playground.Events.call(this),this.element=e,this.buttons={},this.mousemoveEvent={},this.mousedownEvent={},this.mouseupEvent={},this.mousewheelEvent={},this.x=0,this.y=0,this.offsetX=0,this.offsetY=0,this.scale=1,e.addEventListener("mousemove",this.mousemove.bind(this)),e.addEventListener("mousedown",this.mousedown.bind(this)),e.addEventListener("mouseup",this.mouseup.bind(this)),this.enableMousewheel(),this.element.addEventListener("contextmenu",function(t){i.preventContextMenu&&t.preventDefault()}),e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock},playground.Mouse.prototype={lock:function(){this.locked=!0,this.element.requestPointerLock()},unlock:function(){this.locked=!1,document.exitPointerLock()},getElementOffset:function(t){var e=0,i=0;do e+=t.offsetLeft,i+=t.offsetTop;while(t=t.offsetParent);return{x:e,y:i}},update:function(){this.elementOffset=this.getElementOffset(this.element)},mousemove:playground.throttle(function(t){this.x=this.mousemoveEvent.x=(t.pageX-this.elementOffset.x-this.offsetX)/this.scale|0,this.y=this.mousemoveEvent.y=(t.pageY-this.elementOffset.y-this.offsetY)/this.scale|0,this.mousemoveEvent.original=t,this.locked&&(this.mousemoveEvent.movementX=t.movementX||t.mozMovementX||t.webkitMovementX||0,this.mousemoveEvent.movementY=t.movementY||t.mozMovementY||t.webkitMovementY||0),this.parent.mouseToTouch?(this.mousemoveEvent.identifier=this.parent.keyboard.keys.ctrl?1:0,this.trigger("touchmove",this.mousemoveEvent)):this.trigger("mousemove",this.mousemoveEvent)},16),mousedown:function(t){var e=["left","middle","right"][t.button];this.mousedownEvent.x=this.mousemoveEvent.x,this.mousedownEvent.y=this.mousemoveEvent.y,this.mousedownEvent.button=e,this.mousedownEvent.original=t,this[e]=!0,this.parent.mouseToTouch?(this.mousedownEvent.identifier=this.parent.keyboard.keys.ctrl?1:0,this.trigger("touchmove",this.mousedownEvent),this.trigger("touchstart",this.mousedownEvent)):this.trigger("mousedown",this.mousedownEvent)},mouseup:function(t){var e=["left","middle","right"][t.button];this.mouseupEvent.x=this.mousemoveEvent.x,this.mouseupEvent.y=this.mousemoveEvent.y,this.mouseupEvent.button=e,this.mouseupEvent.original=t,this[e]=!1,this.parent.mouseToTouch?(this.mouseupEvent.identifier=this.parent.keyboard.keys.ctrl?1:0,this.trigger("touchend",this.mouseupEvent)):this.trigger("mouseup",this.mouseupEvent)},mousewheel:function(t){this.mousewheelEvent.x=this.mousemoveEvent.x,this.mousewheelEvent.y=this.mousemoveEvent.y,this.mousewheelEvent.button=["none","left","middle","right"][t.button],this.mousewheelEvent.original=t,this.mousewheelEvent.identifier=0,this[t.button]=!1,this.trigger("mousewheel",this.mousewheelEvent)},enableMousewheel:function(){for(var t=("onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"]),e=this.mousewheel.bind(this),i=this,n=t.length;n;)i.element.addEventListener(t[--n],playground.throttle(function(t){var n=t||window.event,s=([].slice.call(arguments,1),0),o=0;t.type="mousewheel",n.wheelDelta&&(s=n.wheelDelta),n.detail&&(s=-1*n.detail),n.deltaY&&(o=-1*n.deltaY,s=o),void 0!==n.wheelDeltaY&&(o=n.wheelDeltaY);var r=s?s:o;i.mousewheelEvent.x=i.mousemoveEvent.x,i.mousewheelEvent.y=i.mousemoveEvent.y,i.mousewheelEvent.delta=r/Math.abs(r),i.mousewheelEvent.original=n,e(i.mousewheelEvent),t.preventDefault()},40),!1)}},playground.extend(playground.Mouse.prototype,playground.Events.prototype),playground.Touch=function(t,e){playground.Events.call(this),this.parent=t,this.element=e,this.buttons={},this.touchmoveEvent={},this.touchstartEvent={},this.touchendEvent={},this.touches={},this.x=0,this.y=0,this.offsetX=0,this.offsetY=0,this.scale=1,e.addEventListener("touchmove",this.touchmove.bind(this)),e.addEventListener("touchstart",this.touchstart.bind(this)),e.addEventListener("touchend",this.touchend.bind(this))},playground.Touch.prototype={getElementOffset:function(t){var e=0,i=0;do e+=t.offsetLeft,i+=t.offsetTop;while(t=t.offsetParent);return{x:e,y:i}},update:function(){this.elementOffset=this.getElementOffset(this.element)},touchmove:function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e];this.x=this.touchmoveEvent.x=(i.pageX-this.elementOffset.x-this.offsetX)/this.scale|0,this.y=this.touchmoveEvent.y=(i.pageY-this.elementOffset.y-this.offsetY)/this.scale|0,this.touchmoveEvent.original=i,this.touchmoveEvent.identifier=i.identifier,this.touches[i.identifier].x=this.touchmoveEvent.x,this.touches[i.identifier].y=this.touchmoveEvent.y,this.trigger("touchmove",this.touchmoveEvent),t.preventDefault()}},touchstart:function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e];this.x=this.touchstartEvent.x=(i.pageX-this.elementOffset.x-this.offsetX)/this.scale|0,this.y=this.touchstartEvent.y=(i.pageY-this.elementOffset.y-this.offsetY)/this.scale|0,this.touchstartEvent.original=t.touch,this.touchstartEvent.identifier=i.identifier,this.touches[i.identifier]={x:this.touchstartEvent.x,y:this.touchstartEvent.y},this.trigger("touchstart",this.touchstartEvent)}},touchend:function(t){for(var e=0;e<t.changedTouches.length;e++){var i=t.changedTouches[e];this.touchendEvent.x=(i.pageX-this.elementOffset.x-this.offsetX)/this.scale|0,this.touchendEvent.y=(i.pageY-this.elementOffset.y-this.offsetY)/this.scale|0,this.touchendEvent.original=i,this.touchendEvent.identifier=i.identifier,delete this.touches[i.identifier],this.trigger("touchend",this.touchendEvent)}}},playground.extend(playground.Touch.prototype,playground.Events.prototype),playground.Keyboard=function(){playground.Events.call(this),this.keys={},document.addEventListener("keydown",this.keydown.bind(this)),document.addEventListener("keyup",this.keyup.bind(this)),document.addEventListener("keypress",this.keypress.bind(this)),this.keydownEvent={},this.keyupEvent={}},playground.Keyboard.prototype={keycodes:{37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equal",188:"comma",189:"dash",190:"period",191:"slash",192:"graveaccent",219:"openbracket",220:"backslash",221:"closebraket",222:"singlequote"},keypress:function(t){},keydown:function(t){if(t.which>=48&&t.which<=90)var e=String.fromCharCode(t.which).toLowerCase();else var e=this.keycodes[t.which];this.keys[e]||(this.keydownEvent.key=e,this.keydownEvent.original=t,this.keys[e]=!0,this.trigger("keydown",this.keydownEvent),this.preventDefault&&document.activeElement===document.body&&(t.returnValue=!1,t.keyCode=0,t.preventDefault(),t.stopPropagation()))},keyup:function(t){if(t.which>=48&&t.which<=90)var e=String.fromCharCode(t.which).toLowerCase();else var e=this.keycodes[t.which];this.keyupEvent.key=e,this.keyupEvent.original=t,this.keys[e]=!1,this.trigger("keyup",this.keyupEvent)}},playground.extend(playground.Keyboard.prototype,playground.Events.prototype),playground.Gamepads=function(){playground.Events.call(this),this.getGamepads=navigator.getGamepads||navigator.webkitGetGamepads,this.gamepadmoveEvent={},this.gamepaddownEvent={},this.gamepadupEvent={},this.gamepads={}},playground.Gamepads.prototype={buttons:{0:"1",1:"2",2:"3",3:"4",4:"l1",5:"r1",6:"l2",7:"r2",8:"select",9:"start",12:"up",13:"down",14:"left",15:"right"},zeroState:function(){for(var t=[],e=0;15>=e;e++)t.push({pressed:!1,value:0});return{axes:[],buttons:t}},createGamepad:function(){for(var t={buttons:{},sticks:[{x:0,y:0},{x:0,y:0}]},e=0;16>e;e++){var i=this.buttons[e];t.buttons[i]=!1}return t},step:function(){if(navigator.getGamepads)for(var t=navigator.getGamepads(),e=0;e<t.length;e++){var i=t[e];if(i){this[e]||(this[e]=this.createGamepad());for(var n=[].concat(i.buttons),s=12;15>=s;s++)n[s]||(n[s]={pressed:!1,value:0});var o=this[e];i.axes&&(i.axes[0]<0&&(n[14].pressed=!0),i.axes[0]>0&&(n[15].pressed=!0),i.axes[1]<0&&(n[12].pressed=!0),i.axes[1]>0&&(n[13].pressed=!0),o.sticks[0].x=i.axes[0].value,o.sticks[0].y=i.axes[1].value,o.sticks[1].x=i.axes[2].value,o.sticks[1].y=i.axes[3].value);for(var r=0;r<n.length;r++){var a=this.buttons[r];n[r].pressed&&!o.buttons[a]?(o.buttons[a]=!0,this.gamepaddownEvent.button=this.buttons[r],this.gamepaddownEvent.gamepad=e,this.trigger("gamepaddown",this.gamepaddownEvent)):!n[r].pressed&&o.buttons[a]&&(o.buttons[a]=!1,this.gamepadupEvent.button=this.buttons[r],this.gamepadupEvent.gamepad=e,this.trigger("gamepadup",this.gamepadupEvent))}}}}},playground.extend(playground.Gamepads.prototype,playground.Events.prototype),playground.Loader=function(){playground.Events.call(this),this.reset()},playground.Loader.prototype={add:function(t){this.queue++,this.count++,this.trigger("add",t)},error:function(t){console.log("unable to load "+t),this.trigger("error",t)},ready:function(t){this.queue--,this.progress=1-this.queue/this.count,this.trigger("load",t),this.queue<=0&&(this.trigger("ready"),this.reset())},reset:function(){this.progress=0,this.queue=0,this.count=0}},playground.extend(playground.Loader.prototype,playground.Events.prototype),CanvasQuery.Layer.prototype.playground=function(t){return t.layer=this,playground(t)},window.Whammy=function(){function t(t,i){for(var n=e(t),n=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:u(n.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:25541},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:n.width,id:176},{data:n.height,id:186}]}]}]}]}],o=0,a=0;o<t.length;){var h=[],d=0;do h.push(t[o]),d+=t[o].duration,o++;while(o<t.length&&3e4>d);var c=0,h={id:524531317,data:[{data:a,id:231}].concat(h.map(function(t){var e=r({discardable:0,frame:t.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(c)});return c+=t.duration,{data:e,id:163}}))};n[1].data.push(h),a+=d}return s(n,i)}function e(t){for(var e=t[0].width,i=t[0].height,n=t[0].duration,s=1;s<t.length;s++){if(t[s].width!=e)throw"Frame "+(s+1)+" has a different width";if(t[s].height!=i)throw"Frame "+(s+1)+" has a different height";if(0>t[s].duration||32767<t[s].duration)throw"Frame "+(s+1)+" has a weird duration (must be between 0 and 32767)";n+=t[s].duration}return{duration:n,width:e,height:i}}function i(t){for(var e=[];t>0;)e.push(255&t),t>>=8;return new Uint8Array(e.reverse())}function n(t){var e=[];t=(t.length%8?Array(9-t.length%8).join("0"):"")+t;for(var i=0;i<t.length;i+=8)e.push(parseInt(t.substr(i,8),2));return new Uint8Array(e)}function s(t,e){for(var r=[],a=0;a<t.length;a++){var h=t[a].data;if("object"==typeof h&&(h=s(h,e)),"number"==typeof h&&(h=n(h.toString(2))),"string"==typeof h){for(var u=new Uint8Array(h.length),d=0;d<h.length;d++)u[d]=h.charCodeAt(d);h=u}d=h.size||h.byteLength||h.length,u=Math.ceil(Math.ceil(Math.log(d)/Math.log(2))/8),d=d.toString(2),d=Array(7*u+8-d.length).join("0")+d,u=Array(u).join("0")+"1"+d,r.push(i(t[a].id)),r.push(n(u)),r.push(h)}return e?(r=o(r),new Uint8Array(r)):new Blob(r,{type:"video/webm"})}function o(t,e){null==e&&(e=[]);for(var i=0;i<t.length;i++)"object"==typeof t[i]?o(t[i],e):e.push(t[i]);return e}function r(t){var e=0;if(t.keyframe&&(e|=128),t.invisible&&(e|=8),t.lacing&&(e|=t.lacing<<1),t.discardable&&(e|=1),127<t.trackNum)throw"TrackNumber > 127 not supported";return[128|t.trackNum,t.timecode>>8,255&t.timecode,e].map(function(t){return String.fromCharCode(t)}).join("")+t.frame}function a(t){for(var e=t.RIFF[0].WEBP[0],i=e.indexOf("*"),n=0,s=[];4>n;n++)s[n]=e.charCodeAt(i+3+n);return n=s[1]<<8|s[0],i=16383&n,n=s[3]<<8|s[2],{width:i,height:16383&n,data:e,riff:t}}function h(t){for(var e=0,i={};e<t.length;){var n=t.substr(e,4),s=parseInt(t.substr(e+4,4).split("").map(function(t){return t=t.charCodeAt(0).toString(2),Array(8-t.length+1).join("0")+t}).join(""),2),o=t.substr(e+4+4,s),e=e+(8+s);i[n]=i[n]||[],i[n].push("RIFF"==n||"LIST"==n?h(o):o)}return i}function u(t){return[].slice.call(new Uint8Array(new Float64Array([t]).buffer),0).map(function(t){return String.fromCharCode(t)}).reverse().join("")}function d(t,e){this.frames=[],this.duration=1e3/t,this.quality=e||.8}return d.prototype.add=function(t,e){if("undefined"!=typeof e&&this.duration)throw"you can't pass a duration if the fps is set";if("undefined"==typeof e&&!this.duration)throw"if you don't have the fps set, you ned to have durations here.";if("canvas"in t&&(t=t.canvas),"toDataURL"in t)t=t.toDataURL("image/webp",this.quality);else if("string"!=typeof t)throw"frame must be a a HTMLCanvasElement, a CanvasRenderingContext2D or a DataURI formatted string";if(!/^data:image\/webp;base64,/gi.test(t))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:t,duration:e||this.duration})},d.prototype.compile=function(e){return new t(this.frames.map(function(t){var e=a(h(atob(t.image.slice(23))));return e.duration=t.duration,e}),e)},{Video:d,fromImageArray:function(e,i,n){return t(e.map(function(t){return t=a(h(atob(t.slice(23)))),t.duration=1e3/i,t}),n)},toWebM:t}}(),playground.VideoRecorder=function(t,e){this.app=t},playground.VideoRecorder.prototype={setup:function(t){this.region=!1,playground.extend(this,{followMouse:!1,framerate:20,scale:1},t),this.region||(this.region=[0,0,this.app.layer.width,this.app.layer.height]),this.playbackRate=this.framerate/60,this.layer=cq(this.region[2]*this.scale|0,this.region[3]*this.scale|0)},start:function(t){this.setup(t),this.encoder=new Whammy.Video(this.framerate),this.captureTimeout=0,this.recording=!0},step:function(t){this.encoder&&(this.captureTimeout-=1e3*t,this.captureTimeout<=0&&(this.captureTimeout=1e3/this.framerate+this.captureTimeout,this.layer.drawImage(this.app.layer.canvas,this.region[0],this.region[1],this.region[2],this.region[3],0,0,this.layer.width,this.layer.height),this.encoder.add(this.layer.canvas)),this.app.screen.save().lineWidth(8).strokeStyle("#c00").strokeRect(0,0,this.app.screen.width,this.app.screen.height).restore())},stop:function(){if(this.encoder){var t=this.encoder.compile(),e=(window.webkitURL||window.URL).createObjectURL(t);window.open(e),this.recording=!1,delete this.encoder}},toggle:function(t){this.encoder?this.stop():this.start(t)}},Playground.SoundInterface={},Playground.Sound=function(t,e){this.parent=t;{var i=(new Audio).canPlayType("audio/mp3");(new Audio).canPlayType('audio/ogg; codecs="vorbis"')}this.audioFormat=i?"mp3":"ogg",this.context=e,this.gainNode=this.context.createGain(),this.gainNode.connect(this.context.destination),this.compressor=this.context.createDynamicsCompressor(),this.compressor.connect(this.gainNode),this.output=this.gainNode,this.gainNode.gain.value=1,this.pool=[],this.volume=1,this.setMasterPosition(0,0,0),this.loops=[]},Playground.Sound.prototype={buffers:{},aliases:{},alias:function(t,e,i,n){this.aliases[t]={source:e,volume:i,rate:n}},setMaster:function(t){this.volume=t,this.gainNode.gain.value=t},load:function(t){var e="sounds/"+t+"."+this.audioFormat,i=this,n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer";var s=this.parent.loader.add();n.onload=function(){i.context.decodeAudioData(this.response,function(e){i.buffers[t]=e,i.parent.loader.ready(s)})},n.send()},cleanArray:function(t,e){for(var i=0,n=t.length;n>i;i++)(null===t[i]||e&&t[i][e])&&(t.splice(i--,1),n--)},setMasterPosition:function(t,e,i){this.masterPosition={x:t,y:e,z:i},this.context.listener.setPosition(t,e,i)},getSoundBuffer:function(){if(!this.pool.length)for(var t=0;100>t;t++){var e,i,n,s=[e=this.context.createBufferSource(),i=this.context.createGain(),n=this.context.createPanner()];n.distanceModel="linear",n.refDistance=1,n.maxDistance=600,n.rolloffFactor=1,this.pool.push(s),s[0].connect(s[1]),s[1].connect(this.output)}return this.pool.pop()},play:function(t,e){var i=this.aliases[t],n=this.getSoundBuffer();return i&&(t=i.source),bufferSource=n[0],bufferSource.gainNode=n[1],bufferSource.pannerNode=n[2],bufferSource.buffer=this.buffers[t],bufferSource.loop=e||!1,bufferSource.key=t,bufferSource.alias=i,this.setVolume(bufferSource,1),this.setPlaybackRate(bufferSource,1),this.loop,bufferSource.start(0),bufferSource.volumeLimit=1,this.setPosition(bufferSource,this.masterPosition.x,this.masterPosition.y,this.masterPosition.z),bufferSource},stop:function(t){t&&t.stop(0)},setPlaybackRate:function(t,e){return t?(t.alias&&(e*=t.alias.rate),t.playbackRate.value=e):void 0},setPosition:function(t,e,i,n){t&&t.pannerNode.setPosition(e,i||0,n||0)},setVelocity:function(t,e,i,n){t&&t.pannerNode.setPosition(e,i||0,n||0)},getVolume:function(t){return t?t.gainNode.gain.value:void 0},setVolume:function(t,e){return t?(t.alias&&(e*=t.alias.volume),t.gainNode.gain.value=Math.max(0,e)):void 0},fadeOut:function(t){return t?(t.fadeOut=!0,this.loops.push(t),t):void 0},fadeIn:function(t){return t?(t.fadeIn=!0,this.loops.push(t),t):void 0},step:function(t){for(var e=0;e<this.loops.length;e++){var i=this.loops[e];if(i.fadeIn){var n=this.getVolume(i);n=this.setVolume(i,Math.min(1,n+.5*t)),n>=1&&(this.loops.splice(e--,1),this.stop(i))}if(i.fadeOut){var n=this.getVolume(i);n=this.setVolume(i,Math.min(1,n-.5*t)),0>=n&&(this.loops.splice(e--,1),this.stop(i))}}}},playground.extend(Playground.Sound.prototype,Playground.SoundInterface),Playground.SoundFallback=function(t){this.parent=t;{var e=(new Audio).canPlayType("audio/mp3");(new Audio).canPlayType('audio/ogg; codecs="vorbis"')}this.audioFormat=e?"mp3":"ogg"},Playground.SoundFallback.prototype={samples:{},setMaster:function(t){this.volume=t},setMasterPosition:function(){},setPosition:function(t,e,i){},load:function(t){var e="sounds/"+t+"."+this.audioFormat,i=this.parent.loader;this.parent.loader.add(e);var n=this.samples[t]=new Audio;n.addEventListener("canplay",function(){i.ready(e)}),n.addEventListener("error",function(){i.error(e)}),n.src=e},play:function(t,e){var i=this.samples[t];return i.currentTime=0,i.loop=e,i.play(),i},stop:function(t){t&&t.pause()},step:function(t){},setPlaybackRate:function(t,e){},setVolume:function(t,e){t.volume=e*this.volume},setPosition:function(){}},playground.extend(Playground.SoundFallback.prototype,Playground.SoundInterface),function(){var t=function(e,i){return"function"==typeof t.cache[i]?t.cache[i](e):t.spline(e,i||t.defaultEasing)},e=function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[0][e]=arguments[t][e];return arguments[0]};e(t,{defaultEasing:"016",cache:{linear:function(t){return t},inQuad:function(t){return t*t},outQuad:function(t){return t*(2-t)},inOutQuad:function(t){return.5>t?2*t*t:-1+(4-2*t)*t},inCubic:function(t){return t*t*t},outCubic:function(t){return--t*t*t+1},inOutCubic:function(t){return.5>t?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},inQuart:function(t){return t*t*t*t},outQuart:function(t){return 1- --t*t*t*t},inOutQuart:function(t){return.5>t?8*t*t*t*t:1-8*--t*t*t*t},inQuint:function(t){return t*t*t*t*t},outQuint:function(t){return 1+--t*t*t*t*t},inOutQuint:function(t){return.5>t?16*t*t*t*t*t:1+16*--t*t*t*t*t},inSine:function(t){return-1*Math.cos(t/1*.5*Math.PI)+1},outSine:function(t){return Math.sin(t/1*.5*Math.PI)},inOutSine:function(t){return-0.5*(Math.cos(Math.PI*t)-1)},inExpo:function(t){return 0==t?0:Math.pow(2,10*(t-1))},outExpo:function(t){return 1==t?1:-Math.pow(2,-10*t)+1},inOutExpo:function(t){return 0==t?0:1==t?1:(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(-Math.pow(2,-10*--t)+2)},inCirc:function(t){return-1*(Math.sqrt(1-t*t)-1)},outCirc:function(t){return Math.sqrt(1-(t-=1)*t)},inOutCirc:function(t){return(t/=.5)<1?-0.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},inElastic:function(t){var e=1.70158,i=0,n=1;if(0==t)return 0;if(1==t)return 1;if(i||(i=.3),1>n){n=1;var e=i/4}else var e=i/(2*Math.PI)*Math.asin(1/n);return-(n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/i))},outElastic:function(t){var e=1.70158,i=0,n=1;if(0==t)return 0;if(1==t)return 1;if(i||(i=.3),1>n){n=1;var e=i/4}else var e=i/(2*Math.PI)*Math.asin(1/n);return n*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/i)+1},inOutElastic:function(t){var e=1.70158,i=0,n=1;if(0==t)return 0;if(2==(t/=.5))return 1;if(i||(i=.3*1.5),1>n){n=1;var e=i/4}else var e=i/(2*Math.PI)*Math.asin(1/n);return 1>t?-.5*n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/i):n*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/i)*.5+1},inBack:function(t,e){return void 0==e&&(e=1.70158),1*t*t*((e+1)*t-e)},outBack:function(t,e){return void 0==e&&(e=1.70158),1*((t=t/1-1)*t*((e+1)*t+e)+1)},inOutBack:function(t,e){return void 0==e&&(e=1.70158),(t/=.5)<1?.5*t*t*(((e*=1.525)+1)*t-e):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},inBounce:function(t){return 1-this.outBounce(1-t)},outBounce:function(t){return(t/=1)<1/2.75?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},inOutBounce:function(t){return.5>t?.5*this.inBounce(2*t):.5*this.outBounce(2*t-1)+.5}},translateEasing:function(t){if(!this.cache[t]){for(var e=t.split(""),i=1,n=!1,s=0;s<e.length;s++){var o=e[s];"-"===o?(i=-1,n=!0,e.splice(s--,1)):"+"===o?(i=1,e.splice(s--,1)):e[s]=parseInt(e[s],16)*i}for(var r=Math.min.apply(null,e),a=Math.max.apply(null,e),h=a-r,u=[],s=0;s<e.length;s++)if(n){var h=Math.max(Math.abs(r),Math.abs(a));u.push(e[s]/h)}else{var h=a-r;u.push((e[s]-r)/h)}this.cache[t]=u}return this.cache[t]},splineK:{},splineX:{},splineY:{},insertIntermediateValues:function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i]),i<t.length-1&&e.push(t[i+1]+.6*(t[i]-t[i+1]));return e},spline:function(t,e){if(!this.splineK[e]){var i=[],n=this.translateEasing(e);if(!n.length)return 0;for(var s=0;s<n.length;s++)i.push(s*(1/(n.length-1)));var o=i.map(function(){return 0});o=this.getNaturalKs(i,n,o),this.splineX[e]=i,this.splineY[e]=n,this.splineK[e]=o}if(t>1)return this.splineY[e][this.splineY[e].length-1];for(var o=this.splineK[e],i=this.splineX[e],n=this.splineY[e],s=1;i[s]<t;)s++;var r=(t-i[s-1])/(i[s]-i[s-1]),a=o[s-1]*(i[s]-i[s-1])-(n[s]-n[s-1]),h=-o[s]*(i[s]-i[s-1])+(n[s]-n[s-1]),u=(1-r)*n[s-1]+r*n[s]+r*(1-r)*(a*(1-r)+h*r);return u},getNaturalKs:function(t,e,i){for(var n=t.length-1,s=this.zerosMat(n+1,n+2),o=1;n>o;o++)s[o][o-1]=1/(t[o]-t[o-1]),s[o][o]=2*(1/(t[o]-t[o-1])+1/(t[o+1]-t[o])),s[o][o+1]=1/(t[o+1]-t[o]),s[o][n+1]=3*((e[o]-e[o-1])/((t[o]-t[o-1])*(t[o]-t[o-1]))+(e[o+1]-e[o])/((t[o+1]-t[o])*(t[o+1]-t[o])));return s[0][0]=2/(t[1]-t[0]),s[0][1]=1/(t[1]-t[0]),s[0][n+1]=3*(e[1]-e[0])/((t[1]-t[0])*(t[1]-t[0])),s[n][n-1]=1/(t[n]-t[n-1]),s[n][n]=2/(t[n]-t[n-1]),s[n][n+1]=3*(e[n]-e[n-1])/((t[n]-t[n-1])*(t[n]-t[n-1])),this.solve(s,i)},solve:function(t,e){for(var i=t.length,n=0;i>n;n++){for(var s=0,o=Number.NEGATIVE_INFINITY,r=n;i>r;r++)t[r][n]>o&&(s=r,o=t[r][n]);this.splineSwapRows(t,n,s);

for(var r=n+1;i>r;r++){for(var a=n+1;i+1>a;a++)t[r][a]=t[r][a]-t[n][a]*(t[r][n]/t[n][n]);t[r][n]=0}}for(var r=i-1;r>=0;r--){var h=t[r][i]/t[r][r];e[r]=h;for(var a=r-1;a>=0;a--)t[a][i]-=t[a][r]*h,t[a][r]=0}return e},zerosMat:function(t,e){for(var i=[],n=0;t>n;n++){i.push([]);for(var s=0;e>s;s++)i[n].push(0)}return i},splineSwapRows:function(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}}),playground.ease=t}(),playground.Tween=function(t,e){this.parent=t,this.context=e,playground.extend(this,{actions:[],index:-1,prevEasing:"045",prevDuration:.5}),this.current=!1},playground.Tween.prototype={add:function(t,e,i){return e?this.prevDuration=e:e=.5,i?this.prevEasing=i:i="045",this.actions.push([t,e,i]),this},to:function(t,e,i){return this.add(t,e,i)},loop:function(){return this.looped=!0,this},repeat:function(t){this.actions.push(["repeat",t])},wait:function(t){return this.actions.push(["wait",t]),this},delay:function(t){this.actions.push(["wait",t])},stop:function(){return this.parent.remove(this),this},play:function(){return this.parent.add(this),this},end:function(){for(var t=0,e=this.index+1;e<this.actions.length;e++)"object"==typeof this.actions[e][0]&&(t=e);return this.index=t-1,this.next(),this.delta=this.duration,this.step(0),this},forward:function(){this.delta=this.duration,this.step(0)},rewind:function(){this.delta=0,this.step(0)},next:function(){if(this.delta=0,this.index++,this.index>=this.actions.length){if(!this.looped)return void this.parent.remove(this);this.index=0}if(this.current=this.actions[this.index],"wait"===this.current[0])this.duration=this.current[1],this.currentAction="wait";else{var t=this.current[0];for(this.keys=Object.keys(t),this.change=[],this.before=[],this.types=[],i=0;i<this.keys.length;i++){var e=this.keys[i];if("number"==typeof this.context[e])this.before.push(this.context[e]),this.change.push(t[e]-this.context[e]),this.types.push(0);else{var n=cq.color(this.context[e]);this.before.push(n);for(var s=cq.color(t[e]),o=[],r=0;3>r;r++)o.push(s[r]-n[r]);this.change.push(o),this.types.push(1)}}this.currentAction="animate",this.duration=this.current[1],this.easing=this.current[2]}},prev:function(){},step:function(t){switch(this.delta+=t,this.current||this.next(),this.currentAction){case"animate":this.doAnimate(t);break;case"wait":this.doWait(t)}},doAnimate:function(t){this.progress=Math.min(1,this.delta/this.duration);for(var e=playground.ease(this.progress,this.easing),i=0;i<this.keys.length;i++){var n=this.keys[i];switch(this.types[i]){case 0:this.context[n]=this.before[i]+this.change[i]*e;break;case 1:for(var s=this.change[i],o=this.before[i],r=[],a=0;3>a;a++)r.push(o[a]+s[a]*e|0);this.context[n]="rgb("+r.join(",")+")"}}this.progress>=1&&this.next()},doWait:function(t){this.delta>=this.duration&&this.next()}},playground.TweenManager=function(t){this.tweens=[],t&&(this.parent=t,this.parent.tween=this.tween.bind(this)),this.delta=0},playground.TweenManager.prototype={defaultEasing:"128",tween:function(t){var e=new playground.Tween(this,t);return this.add(e),e},step:function(t){this.delta+=t;for(var e=0;e<this.tweens.length;e++){var i=this.tweens[e];i.step(t),i._remove&&this.tweens.splice(e--,1)}},add:function(t){t._remove=!1;var e=this.tweens.indexOf(t);-1===e&&this.tweens.push(t)},remove:function(t){t._remove=!0}},module.exports=playground;


},{"canvasquery":"canvasquery"}]},{},[1])(1)
});


//# sourceMappingURL=playground.js.map